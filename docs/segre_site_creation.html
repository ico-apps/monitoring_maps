<!DOCTYPE html>
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="robots" content="NONE,NOARCHIVE" />

  <title>#1 Fulleda – ICO monitoring</title>

  <!-- font awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
    integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous" />

  <!-- leaflet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css"
    integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"
    integrity="sha256-XzD3RpaHPv7lzX9qt+2n1j5cWj48O24KsgaGYpKN8x8=" crossorigin="anonymous" />

  <!-- bootstrap -->

  <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet">

  <!-- ico_monitoring -->
  <link rel="stylesheet" type="text/css" href="../src/css/map.css" />

    <style>
    #map {
      width: 100%;
      height: 600px;
    }
    .section_info{

      background-color: #fff;
      border: 2px solid rgba(0,0,0,0.2);
      background-clip: padding-box;
      border-radius: 4px;
      padding: 5px;
    }
    .obs_point {
      text-align: center; /* Horizontally center the text (icon) */
      line-height: 20px; /* Vertically center the text (icon) */
    }
    </style>





</head>




<body class="">


  <div class="wrapper">

    <div id="content" class="container-fluid pt-3 pl-4 pr-4">

          <div class="row">

            <div class="col-6">


                    <div class="content-title mb-4">
                      <div class="float-right">

                      </div>

                      <h1>New Monitoring Site </h1>

                    </div>


                        <form role="form" method="post">


              <input type="hidden" name="csrfmiddlewaretoken" value="4IZRzRkY2eDpRFk71pQBbmAVRAPNLBVWfU26OyMM7jXQVbDm8BCfcAi6dHnAianN">
              <div class="form-group"><label for="id_name">Nom</label><input type="text" name="name" maxlength="255" class="form-control" placeholder="Nom" title="" required="" id="id_name"></div>
              <div class="form-group"><label for="id_code">Codi</label><input type="text" name="code" maxlength="255" class="form-control" placeholder="Codi" title="" required="" id="id_code"></div>
              <div class="form-group"><label for="id_description">Descripció</label><textarea name="description" cols="40" rows="10" class="form-control" placeholder="Descripció" title="" id="id_description"></textarea></div>
              <div class="form-group"><label for="id_labels">Etiquetes</label>
                <select name="labels" class="form-control" title="" id="id_labels" multiple="">
                  <option value="1">DIBA</option>
                </select>
            </div>

              <div class="form-actions-no-box">
                <input class="btn btn-success" type="submit" name="submit" value="Crea">
                <a class="btn btn-outline-secondary" href="/socc/monitoringsites/">Cancel·lar</a>
              </div>
            </form>


            </div>


            <div class="col-6">

              <div id="map" class="mx-auto"></div>

            </div>


          </div>
          <div class="card">
            <div class="card-body">
              <form action="#" method="post" onsubmit="return false;">
              <input type="hidden" name="csrfmiddlewaretoken" value="gEZbLZ5xSpmFn7whY6ZsJIj1RRTZt1zb1Bn53nhPtTQikNt1xWdddJwHxcTRHeZe">
              <div class="row mt-2">
                <div class="col text-right">
                  <button href="javascript:void(0)" id="exportShpLayer" class="btn btn-primary">Desar</button>
                </div>
                <div class="col text-left">
                  <a href="/socc/monitoringsites/1/" class="btn btn-danger">Cancel</a>
                </div>
              </div>
              </form>


            </div>
          </div>

    </div><!-- ./content -->
  </div><!-- ./wrapper -->



  <!-- font awesome -->
  <script src="https://kit.fontawesome.com/969e4441b7.js" crossorigin="anonymous"></script>

  <script crossorigin="anonymous" integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


  <!-- leaflet & dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.5.0/proj4.js"
    integrity="sha256-KJI74PS1qv3+hue+yyIWK/l8TxvS9u4WX7QDrtHkHOo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js"
    integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"
    integrity="sha256-siofc4Uwjlra3YWkwthOn8Uj69cNN4aMug/iOHNiRgs=" crossorigin="anonymous"></script>

  <script src="../src/js/shp/leaflet.filelayer.js"></script>
  <script src="../src/js/shp/shp.min.js"></script>
  <script src="../src/js/shp/togeojson.js"></script>

  <script src="../src/js/map.js"></script>
  <script src="../src/js/draw_manager.js"></script>
  <script src="../src/js/protocols/draw_segre.js"></script>
  <script src="../src/js/map_layers.js"></script>

  <script src="data/segre_grid2km_json.js"></script>
  <script src="data/segre_monitoring_sites.js"></script>


    <script>

      /* Leaflet map init with some active layers and centered to Catalonia */
      var map=MapMultiLayer.init(
        {'active_layers':['aerial','osm', 'topo'],
        'zoom':8,
        'center':{'latitude':41.68111756290652,'longitude':1.702880859375},
        'layer_selector_position': 'topleft'
        }
      );

      var last_selected='';

              var unique_monitoring_sites={};

       $.each(monitoringsite_list, function(i, field){

         unique_monitoring_sites[field['code']]=field['name'];

       });

      showSitesDistribution('rapis');
      /* Init drawing lib for the SOCC monitoringscheme. Only allows to draw or upload 6 LineStrings   */

      function showSitesDistribution(scheme_code){

            var active_layer='Quadrats assignats';
            var not_active_layer='Quadrats sense assignar';

            LayerManager.create(active_layer,{
                    color: "#28a745",
                    fillColor: "#28a745",
                    fillOpacity: 1,
                    radius: 50.0
                });

            LayerManager.create(not_active_layer,{
                    color: "#ffc107",
                    fillColor: "#ffc107",
                    fillOpacity: 0.1,
                    radius: 50.0
                });


                LayerManager.setPointClickContent(function (data) {

                  var site_text='';

                  if(data['assigned']) site_text='<br/> <small>'+data['site_name']+'</small>';
                  else{

                    $('#id_code').val(data['name']);
                    if(last_selected!='') LayerManager.changeFeatureStyle(not_active_layer, last_selected,{ fillOpacity: 0.1 });
                    alert(data['name']);
                    LayerManager.changeFeatureStyle(not_active_layer, data['name'],{ fillOpacity: 1 });

                    last_selected=data['name'];

                  }

                  return  '<i class="fas fa-times-circle remove-filter"  data-toggle="tooltip" data-placement="left" title="" data-original-title="Elimina el filtre"></i>'+
                  '<span class="badge badge-dark">'+data['name']+'</span>'+site_text;

                 });

               $( ".loader" ).show();


                  active=0;
                  not_active=0;
                  $( ".loader" ).hide();


                  for (var i=0; i < geojson_grid['features'].length; i++){

                      var assigned=false;

                      if(unique_monitoring_sites[geojson_grid['features'][i]['properties']['name']]) assigned=true;

                      if(assigned)  active++;
                      else not_active++;

                      geojson_grid['features'][i]['properties']['assigned']=assigned;
                      if(assigned) geojson_grid['features'][i]['properties']['site_name'] = unique_monitoring_sites[geojson_grid['features'][i]['properties']['name']];

                      var layer = assigned ? active_layer : not_active_layer;
                      LayerManager.addSquare(layer,geojson_grid['features'][i],geojson_grid['features'][i]['properties']);

                  }



                 LayerManager.addLegendItem(active_layer,'#28a745','fa-square', active);
                 LayerManager.addLegendItem(not_active_layer,'#ffc107','fa-square', not_active);

                 LayerManager.showControls();
                 LayerManager.updateLegend();

      }


    </script>


</body>


</html>
